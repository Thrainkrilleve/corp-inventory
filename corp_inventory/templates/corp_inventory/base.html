{% extends "allianceauth/base.html" %}
{% load static %}
{% load i18n %}

{% block page_title %}{{ title }} - Corp Inventory{% endblock %}

{% block content %}
<div class="corp-inventory-wrapper">

    <!-- Global Nav Bar (top-left, consistent across all pages) -->
    <div class="ci-navbar">
        <div class="btn-group" role="group">
            <a href="{% url 'corp_inventory:index' %}" class="btn btn-default btn-sm{% if request.resolver_match.url_name == 'index' %} active{% endif %}">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            {% if perms.corp_inventory.manage_corporations %}
            <a href="{% url 'corp_inventory:manage_corporations' %}" class="btn btn-default btn-sm{% if request.resolver_match.url_name == 'manage_corporations' %} active{% endif %}">
                <i class="fas fa-building"></i> Manage Corps
            </a>
            <a href="{% url 'corp_inventory:logs' %}" class="btn btn-default btn-sm{% if request.resolver_match.url_name == 'logs' %} active{% endif %}">
                <i class="fas fa-stethoscope"></i> Diagnostics
            </a>
            {% endif %}
        </div>
    </div>

    <div class="container-fluid ci-content">
        {% block corp_inventory_content %}
        {% endblock %}
    </div>

</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'corp_inventory/css/corp_inventory.css' %}">
{% endblock %}

{% block extra_javascript %}
<script src="{% static 'corp_inventory/js/corp_inventory.js' %}"></script>
<script>
    // Format ISK values
    function formatISK(value) {
        return new Intl.NumberFormat('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        }).format(value) + ' ISK';
    }
    
    // Format numbers with commas
    function formatNumber(value) {
        return new Intl.NumberFormat('en-US').format(value);
    }
    
    $(document).ready(function() {
        // Initialize tooltips
        $('[data-toggle="tooltip"]').tooltip();
        
        // Format ISK values â€” skip elements already formatted by Python (contain B/M/T/K or commas)
        $('.isk-value').each(function() {
            var text = $(this).text().trim();
            // If already contains abbreviation letters or thousands commas, leave it alone
            if (/[BMTKbmtk,]/.test(text)) return;
            // Strip trailing " ISK" label if present, then parse
            var numeric = text.replace(/\s*ISK\s*$/i, '').trim();
            var value = parseFloat(numeric);
            if (!isNaN(value)) {
                $(this).text(formatISK(value));
            }
        });
    });
</script>
{% endblock %}
