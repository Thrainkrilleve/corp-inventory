{% extends "corp_inventory/base.html" %}
{% load i18n %}
{% load humanize %}

{% block corp_inventory_content %}
<div class="row">
    <div class="col-md-12">
        <h1><i class="fas fa-warehouse"></i> Corp Inventory Dashboard</h1>
        <p class="lead">Track and monitor corporation hangar assets across all locations</p>
    </div>
</div>
    
    {% if not corp_stats %}
    <div class="row">
        <div class="col-md-12">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>No corporations being tracked.</strong>
                {% if perms.corp_inventory.manage_corporations %}
                <p>
                    <a href="{% url 'corp_inventory:manage_corporations' %}" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Your First Corporation
                    </a>
                </p>
                {% else %}
                <p>Contact your administrator to set up corporation hangar tracking.</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="row">
        {% for stat in corp_stats %}
        <div class="col-md-6 col-lg-4">
            <div class="stat-card">

                <!-- Card header: corp logo + name -->
                <div class="corp-card-header">
                    <img src="https://images.evetech.net/corporations/{{ stat.corporation.corporation_id }}/logo?size=64"
                         alt="{{ stat.corporation.corporation_name }}"
                         title="{{ stat.corporation.corporation_name }}">
                    <div style="flex:1;min-width:0;">
                        <h3 style="margin:0;padding-bottom:0;border-bottom:none;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                            {{ stat.corporation.corporation_name }}
                        </h3>
                        {% if stat.corporation.ticker %}
                        <small class="text-muted">[{{ stat.corporation.ticker }}]</small>
                        {% endif %}
                    </div>
                </div>

                <hr style="margin:10px 0;">

                <!-- Stats row -->
                <div class="row">
                    <div class="col-xs-6">
                        <div class="stat-number">{{ stat.active_items|intcomma }}</div>
                        <div class="stat-label">Items</div>
                    </div>
                    <div class="col-xs-6">
                        <div class="stat-number isk-value">
                            {% with val=stat.total_value %}
                            {% if val >= 1000000000000 %}
                                {{ val|floatformat:0|slice:"-12" }}T
                            {% elif val >= 1000000000 %}
                                {{ val|floatformat:0|slice:"-9" }}B
                            {% elif val >= 1000000 %}
                                {{ val|floatformat:0|slice:"-6" }}M
                            {% else %}
                                {{ val|floatformat:0|intcomma }}
                            {% endif %}
                            {% endwith %}
                        </div>
                        <div class="stat-label">Total Value (ISK)</div>
                    </div>
                </div>

                <!-- Wallet balance -->
                {% if stat.corporation.wallet_balance %}
                <div class="wallet-balance-row">
                    <span class="wallet-balance-label"><i class="fas fa-coins"></i> Corp Wallet:</span>
                    <span class="isk-value" style="font-size:14px;font-weight:600;">
                        {% with wb=stat.corporation.wallet_balance %}
                        {% if wb >= 1000000000000 %}
                            {{ wb|floatformat:2 }}
                        {% else %}
                            {{ wb|intcomma|floatformat:0 }}
                        {% endif %}
                        {% endwith %}
                        ISK
                    </span>
                </div>
                {% endif %}

                <hr style="margin:10px 0;">

                <!-- Sync + activity info -->
                <div class="row">
                    <div class="col-xs-6">
                        <small>
                            <i class="fas fa-sync-alt text-muted"></i>
                            <strong>{% trans "Last Sync" %}:</strong><br>
                            {% if stat.last_sync %}
                                <span class="sync-status {% if stat.last_sync > one_hour_ago %}recent{% else %}old{% endif %}">
                                    {{ stat.last_sync|naturaltime }}
                                </span>
                            {% else %}
                                <span class="sync-status old">{% trans "Never" %}</span>
                            {% endif %}
                        </small>
                    </div>
                    <div class="col-xs-6">
                        <small>
                            <i class="fas fa-exchange-alt text-muted"></i>
                            <strong>{% trans "7-day Txns" %}:</strong><br>
                            {{ stat.recent_transactions|intcomma }}
                        </small>
                    </div>
                </div>
                
                <hr style="margin:10px 0;">
                
                <!-- Action buttons -->
                <div class="btn-group btn-group-justified" style="margin-bottom:4px;">
                    <a href="{% url 'corp_inventory:corporation_hangar' stat.corporation.corporation_id %}" 
                       class="btn btn-primary btn-sm">
                        <i class="fas fa-boxes"></i> Hangar
                    </a>
                    <a href="{% url 'corp_inventory:corporation_transactions' stat.corporation.corporation_id %}" 
                       class="btn btn-info btn-sm">
                        <i class="fas fa-list"></i> Txns
                    </a>
                    <a href="{% url 'corp_inventory:statistics' stat.corporation.corporation_id %}" 
                       class="btn btn-default btn-sm">
                        <i class="fas fa-chart-bar"></i> Stats
                    </a>
                    <a href="{% url 'corp_inventory:container_logs' stat.corporation.corporation_id %}"
                       class="btn btn-default btn-sm"
                       title="Container access logs">
                        <i class="fas fa-lock"></i> Logs
                    </a>
                </div>

                {% if perms.corp_inventory.manage_tracking %}
                <a href="{% url 'corp_inventory:sync_corporation' stat.corporation.corporation_id %}" 
                   class="btn btn-warning btn-sm btn-block" style="margin-top:4px;">
                    <i class="fas fa-sync"></i> Sync Now
                </a>
                {% endif %}

            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
{% endblock %}
